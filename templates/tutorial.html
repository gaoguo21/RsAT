{% extends "base.html" %}
{% block title %}RNA-seq Tools Tutorial{% endblock %}

{% block extra_css %}
<style>
  .doc-intro {
    max-width: 900px;
    margin: 0 auto 20px;
    color: #444;
    line-height: 1.7;
  }

  .doc-section {
    background: white;
    border: 1px solid #ddd;
    border-radius: 12px;
    padding: 24px;
    margin-bottom: 22px;
  }

  .doc-section h2 {
    margin-top: 0;
    font-size: 26px;
  }

  .section-desc {
    color: #555;
    line-height: 1.7;
  }

  .example-card {
    border: 1px solid #e1e5f0;
    border-radius: 10px;
    margin: 16px 0 18px;
    overflow: hidden;
    background: #f9fafc;
  }

  .example-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 10px 14px;
    border-bottom: 1px solid #e1e5f0;
    background: #f2f4f8;
    font-weight: 700;
  }

  .example-card pre {
    margin: 0;
    padding: 14px;
    overflow-x: auto;
    font-size: 14px;
    line-height: 1.6;
  }

  .copy-btn {
    border: none;
    background: #2e62ff;
    color: white;
    padding: 8px 14px;
    border-radius: 8px;
    font-weight: 700;
    cursor: pointer;
    font-size: 13px;
  }

  .copy-btn.copied {
    background: #1f4ee3;
  }

  @media (max-width: 820px) {
    .doc-section {
      padding: 20px;
    }
  }
</style>
{% endblock %}

{% block content %}
<div class="container">
  <div class="hero">
    <h1>RNA-seq Tools Tutorial</h1>
    <p class="doc-intro">
      This page walks through how to prepare inputs and run each tool. Use the examples below as templates,
      then adapt them to your data to get reliable results.
    </p>
  </div>

  <section id="deg" class="doc-section">
    <h2>DEG: Differential Gene Expression</h2>
    <p class="section-desc">
      Upload a raw count matrix with one gene per row and samples in columns. Make sure sample names match
      your group labels exactly, and keep counts untransformed (no TPM/RPKM).
    </p>

    <div class="example-card">
      <div class="example-header">
        <span>Example input</span>
        <button class="copy-btn" data-target="deg-example">Copy</button>
      </div>
      <pre><code id="deg-example">Gene	Sample_A1	Sample_A2	Sample_B1	Sample_B2
BRCA1	123	118	95	102
BRCA2	45	51	38	41
TP53	300	289	275	290
EGFR	210	198	165	172</code></pre>
    </div>
  </section>

  <section id="pathway" class="doc-section">
    <h2>Pathway Analysis</h2>
    <p class="section-desc">
      Provide a ranked gene list with fold change or logFC values. This should be ordered in descending order
      (highest logFC at the top) so enrichment tools interpret the direction correctly.
    </p>

    <div class="example-card">
      <div class="example-header">
        <span>Example input</span>
        <button class="copy-btn" data-target="pathway-example">Copy</button>
      </div>
      <pre><code id="pathway-example">Gene	logFC
MYC	2.35
STAT3	1.88
VEGFA	1.42
EGFR	1.10
BRCA1	0.85
BRCA2	0.41
TP53	0.10</code></pre>
    </div>
  </section>

  <section id="id2symbol" class="doc-section">
    <h2>ID2Symbol: ID Mapping</h2>
    <p class="section-desc">
      Supply Ensembl (ENSG) or Entrez IDs, one per line. Remove version suffixes like “.1” from Ensembl IDs
      and select the correct organism to avoid mismatches.
    </p>

    <div class="example-card">
      <div class="example-header">
        <span>Example input</span>
        <button class="copy-btn" data-target="id2symbol-example">Copy</button>
      </div>
      <pre><code id="id2symbol-example">GeneID
ENSG00000187243
ENSG00000171316
ENSG00000213071
ENSG00000237440
ENSG00000111305
</code></pre>
    </div>
  </section>

  <section id="ssgsea" class="doc-section">
    <h2>ssGSEA: Single-Sample GSEA</h2>
    <p class="section-desc">
      Use an expression matrix with genes in rows and samples in columns. The tool expects normalized values
      (such as log2 TPM) and gene sets in GMT format.
    </p>

    <div class="example-card">
      <div class="example-header">
        <span>Example input</span>
        <button class="copy-btn" data-target="ssgsea-example">Copy</button>
      </div>
      <pre><code id="ssgsea-example">Gene	Sample_1	Sample_2	Sample_3
TP53	7.2	7.5	6.9
BRCA1	5.1	5.3	4.9
BRCA2	4.6	4.9	4.2
EGFR	6.0	5.7	5.5
MYC	8.2	8.0	7.8</code></pre>
    </div>
  </section>


  <p class="workflow-cta">
    For those interested in the RNA-seq workflow and AI coding details,
    <a href="/workflow">click here</a>.
  </p>


</div>
{% endblock %}

{% block extra_js %}
<script>
  document.querySelectorAll(".copy-btn").forEach((btn) => {
    btn.addEventListener("click", async () => {
      const targetId = btn.getAttribute("data-target");
      const codeEl = document.getElementById(targetId);
      if (!codeEl) {
        return;
      }
      const text = codeEl.innerText.replace(/\s+$/g, "");
      try {
        await navigator.clipboard.writeText(text);
      } catch (err) {
        const selection = window.getSelection();
        const range = document.createRange();
        range.selectNodeContents(codeEl);
        selection.removeAllRanges();
        selection.addRange(range);
        document.execCommand("copy");
        selection.removeAllRanges();
      }
      const original = btn.textContent;
      btn.textContent = "Copied!";
      btn.classList.add("copied");
      setTimeout(() => {
        btn.textContent = original;
        btn.classList.remove("copied");
      }, 1500);
    });
  });
</script>
{% endblock %}
